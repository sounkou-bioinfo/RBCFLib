HTSLIB_DIR=$(CURDIR)/htslib-1.22
BCFTOOLS_DIR=$(CURDIR)/bcftools-1.22

# Platform-specific linker flags
UNAME := $(shell uname)
ifeq ($(UNAME), Linux)
  PKG_LIBS_EXTRA=-Wl,--exclude-libs,ALL
else
  PKG_LIBS_EXTRA=
endif

# Check for CHOLMOD
HAVE_CHOLMOD=@HAVE_CHOLMOD@
# Check for GSL
HAVE_GSL=@HAVE_GSL@

ifeq ($(HAVE_CHOLMOD),yes)
  ifeq ($(HAVE_GSL),yes)
    PKG_CPPFLAGS=-I$(HTSLIB_DIR) -I$(CURDIR)/BCFToolsScore -I$(HTSLIB_DIR)/htslib -I$(BCFTOOLS_DIR) -I$(BCFTOOLS_DIR) -I../inst/include -DHAVE_CHOLMOD @EXTRA_CPPFLAGS@ @CHOLMOD_CPPFLAGS@
    PKG_LIBS=$(BCFTOOLS_DIR)/libRbcftools.a $(HTSLIB_DIR)/libhts.a @EXTRA_LIBS@ @CHOLMOD_LIBS@ @GSL_LIBS@ $(PKG_LIBS_EXTRA)
  else
    PKG_CPPFLAGS=-I$(HTSLIB_DIR) -I$(CURDIR)/BCFToolsScore -I$(HTSLIB_DIR)/htslib -I$(BCFTOOLS_DIR) -I$(BCFTOOLS_DIR) -I../inst/include -DHAVE_CHOLMOD @EXTRA_CPPFLAGS@ @CHOLMOD_CPPFLAGS@
    PKG_LIBS=$(BCFTOOLS_DIR)/libRbcftools.a $(HTSLIB_DIR)/libhts.a @EXTRA_LIBS@ @CHOLMOD_LIBS@ $(PKG_LIBS_EXTRA)
  endif
else
  ifeq ($(HAVE_GSL),yes)
    PKG_CPPFLAGS=-I$(HTSLIB_DIR) -I$(CURDIR)/BCFToolsScore -I$(HTSLIB_DIR)/htslib -I$(BCFTOOLS_DIR) -I$(BCFTOOLS_DIR) -I../inst/include @EXTRA_CPPFLAGS@
    PKG_LIBS=$(BCFTOOLS_DIR)/libRbcftools.a $(HTSLIB_DIR)/libhts.a @EXTRA_LIBS@ @GSL_LIBS@ $(PKG_LIBS_EXTRA)
  else
    PKG_CPPFLAGS=-I$(HTSLIB_DIR) -I$(CURDIR)/BCFToolsScore -I$(HTSLIB_DIR)/htslib -I$(BCFTOOLS_DIR) -I$(BCFTOOLS_DIR) -I../inst/include @EXTRA_CPPFLAGS@
    PKG_LIBS=$(BCFTOOLS_DIR)/libRbcftools.a $(HTSLIB_DIR)/libhts.a @EXTRA_LIBS@ $(PKG_LIBS_EXTRA)
  endif
endif

.PHONY: all

all: $(SHLIB)
